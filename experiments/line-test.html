<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script src="./1.4.1.p5.js"></script>
  <script type="module">
    const canv = 
    Object.assign(window, {
      size (width, height) {}
    })
  </script>
  <script type="text/javascript">
    function setup () {
      createCanvas(600, 400);
      console.log('setup', setup)
    }
    
      let  x1 = 0;      // points for line (controlled by mouse)
      let  y1 = 0;
      let  x2 = 0;      // static point
      let  y2 = 0;

      let  sx = 200;    // square position
      let  sy = 100;
      let  sw = 200;    // and size
      let  sh = 200;

      function draw() {
        background(255);
        // background(255);

        // set end of line to mouse coordinates
        x1 = mouseX;
        y1 = mouseY;

        // check if line has hit the square
        // if so, change the fill color
        const hit = lineRect(x1,y1,x2,y2, sx,sy,sw,sh);
        if (hit) {
          fill(255,150,0);
        }
        else {
          fill(0,150,255);
        }
        // noStroke();
        rect(sx, sy, sw, sh);

        // draw the line
        stroke(0, 150);
        line(x1, y1, x2, y2);
      }


      // LINE/RECTANGLE
      const lineRect = (x1, y1, x2, y2, rx, ry, rw, rh) => {

        // check if the line has hit any of the rectangle's sides
        // uses the Line/Line function below
        const left =   lineLine(x1,y1,x2,y2, rx,ry,rx, ry+rh);
        const right =  lineLine(x1,y1,x2,y2, rx+rw,ry, rx+rw,ry+rh);
        const top =    lineLine(x1,y1,x2,y2, rx,ry, rx+rw,ry);
        const bottom = lineLine(x1,y1,x2,y2, rx,ry+rh, rx+rw,ry+rh);

        // if ANY of the above are true, the line
        // has hit the rectangle
        if (left || right || top || bottom) {
          return true;
        }
        return false;
      }


      // LINE/LINE
      const lineLine = (x1, y1, x2, y2, x3, y3, x4, y4) => {

        // calculate the direction of the lines
        const  uA = ((x4-x3)*(y1-y3) - (y4-y3)*(x1-x3)) / ((y4-y3)*(x2-x1) - (x4-x3)*(y2-y1));
        const  uB = ((x2-x1)*(y1-y3) - (y2-y1)*(x1-x3)) / ((y4-y3)*(x2-x1) - (x4-x3)*(y2-y1));

        // if uA and uB are between 0-1, lines are colliding
        if (uA >= 0 && uA <= 1 && uB >= 0 && uB <= 1) {

          // optionally, draw a circle where the lines meet
          const intersectionX = x1 + (uA * (x2-x1));
          const intersectionY = y1 + (uA * (y2-y1));
          fill(255,0,0);
          ellipse(intersectionX, intersectionY, 20, 20);

          return true;
        }
        return false;
      }
  </script>
</body>
</html>